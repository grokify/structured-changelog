{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/grokify/structured-changelog/schema/changelog-v1.schema.json",
  "title": "Structured Changelog IR",
  "description": "JSON Intermediate Representation for changelogs following Keep a Changelog format",
  "type": "object",
  "required": ["irVersion", "project"],
  "properties": {
    "irVersion": {
      "type": "string",
      "description": "Version of the IR schema",
      "enum": ["1.0"]
    },
    "project": {
      "type": "string",
      "description": "Name of the project"
    },
    "repository": {
      "type": "string",
      "format": "uri",
      "description": "URL of the project repository"
    },
    "tagPath": {
      "type": "string",
      "description": "Path prefix for version tags (e.g., 'sdk/go' for nested Go modules where tags are 'sdk/go/v1.0.0')"
    },
    "generatedAt": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp when this IR was generated"
    },
    "unreleased": {
      "$ref": "#/definitions/releaseContent",
      "description": "Changes not yet released"
    },
    "releases": {
      "type": "array",
      "description": "List of releases in reverse chronological order",
      "items": {
        "$ref": "#/definitions/release"
      }
    }
  },
  "definitions": {
    "release": {
      "type": "object",
      "required": ["version", "date"],
      "properties": {
        "version": {
          "type": "string",
          "description": "Semantic version string",
          "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"
        },
        "date": {
          "type": "string",
          "format": "date",
          "description": "Release date in YYYY-MM-DD format"
        },
        "yanked": {
          "type": "boolean",
          "description": "Whether this release has been yanked/retracted",
          "default": false
        },
        "compareUrl": {
          "type": "string",
          "format": "uri",
          "description": "URL to compare this release with the previous one"
        },
        "highlights": {
          "$ref": "#/definitions/entryList",
          "description": "Release summaries and key takeaways (standard tier)"
        },
        "breaking": {
          "$ref": "#/definitions/entryList",
          "description": "Backward-incompatible changes (standard tier)"
        },
        "upgradeGuide": {
          "$ref": "#/definitions/entryList",
          "description": "Migration instructions and upgrade paths (standard tier)"
        },
        "security": {
          "$ref": "#/definitions/securityEntryList",
          "description": "Vulnerabilities, CVE fixes, security changes (core tier)"
        },
        "added": {
          "$ref": "#/definitions/entryList",
          "description": "New features or capabilities (core tier)"
        },
        "changed": {
          "$ref": "#/definitions/entryList",
          "description": "Modifications to existing functionality (core tier)"
        },
        "deprecated": {
          "$ref": "#/definitions/entryList",
          "description": "Features that will be removed in future (core tier)"
        },
        "removed": {
          "$ref": "#/definitions/entryList",
          "description": "Features that have been removed (core tier)"
        },
        "fixed": {
          "$ref": "#/definitions/entryList",
          "description": "Bug fixes and correctness improvements (core tier)"
        },
        "performance": {
          "$ref": "#/definitions/entryList",
          "description": "Speed and efficiency improvements (standard tier)"
        },
        "dependencies": {
          "$ref": "#/definitions/entryList",
          "description": "Dependency updates (standard tier)"
        },
        "documentation": {
          "$ref": "#/definitions/entryList",
          "description": "Documentation changes (extended tier)"
        },
        "build": {
          "$ref": "#/definitions/entryList",
          "description": "CI/CD and build tooling changes (extended tier)"
        },
        "tests": {
          "$ref": "#/definitions/entryList",
          "description": "Test additions, improvements, and coverage changes (extended tier)"
        },
        "infrastructure": {
          "$ref": "#/definitions/entryList",
          "description": "Deployment and hosting changes (optional tier)"
        },
        "observability": {
          "$ref": "#/definitions/entryList",
          "description": "Logging, metrics, tracing changes (optional tier)"
        },
        "compliance": {
          "$ref": "#/definitions/entryList",
          "description": "Regulatory and policy updates (optional tier)"
        },
        "internal": {
          "$ref": "#/definitions/entryList",
          "description": "Refactors and internal changes (optional tier)"
        },
        "knownIssues": {
          "$ref": "#/definitions/entryList",
          "description": "Known problems and limitations (extended tier)"
        },
        "contributors": {
          "$ref": "#/definitions/entryList",
          "description": "Contributor acknowledgments (extended tier)"
        }
      }
    },
    "releaseContent": {
      "type": "object",
      "description": "Content categories for a release, organized by tier",
      "properties": {
        "highlights": {
          "$ref": "#/definitions/entryList",
          "description": "Release summaries and key takeaways (standard tier)"
        },
        "breaking": {
          "$ref": "#/definitions/entryList",
          "description": "Backward-incompatible changes (standard tier)"
        },
        "upgradeGuide": {
          "$ref": "#/definitions/entryList",
          "description": "Migration instructions and upgrade paths (standard tier)"
        },
        "security": {
          "$ref": "#/definitions/securityEntryList",
          "description": "Vulnerabilities, CVE fixes, security changes (core tier)"
        },
        "added": {
          "$ref": "#/definitions/entryList",
          "description": "New features or capabilities (core tier)"
        },
        "changed": {
          "$ref": "#/definitions/entryList",
          "description": "Modifications to existing functionality (core tier)"
        },
        "deprecated": {
          "$ref": "#/definitions/entryList",
          "description": "Features that will be removed in future (core tier)"
        },
        "removed": {
          "$ref": "#/definitions/entryList",
          "description": "Features that have been removed (core tier)"
        },
        "fixed": {
          "$ref": "#/definitions/entryList",
          "description": "Bug fixes and correctness improvements (core tier)"
        },
        "performance": {
          "$ref": "#/definitions/entryList",
          "description": "Speed and efficiency improvements (standard tier)"
        },
        "dependencies": {
          "$ref": "#/definitions/entryList",
          "description": "Dependency updates (standard tier)"
        },
        "documentation": {
          "$ref": "#/definitions/entryList",
          "description": "Documentation changes (extended tier)"
        },
        "build": {
          "$ref": "#/definitions/entryList",
          "description": "CI/CD and build tooling changes (extended tier)"
        },
        "tests": {
          "$ref": "#/definitions/entryList",
          "description": "Test additions, improvements, and coverage changes (extended tier)"
        },
        "infrastructure": {
          "$ref": "#/definitions/entryList",
          "description": "Deployment and hosting changes (optional tier)"
        },
        "observability": {
          "$ref": "#/definitions/entryList",
          "description": "Logging, metrics, tracing changes (optional tier)"
        },
        "compliance": {
          "$ref": "#/definitions/entryList",
          "description": "Regulatory and policy updates (optional tier)"
        },
        "internal": {
          "$ref": "#/definitions/entryList",
          "description": "Refactors and internal changes (optional tier)"
        },
        "knownIssues": {
          "$ref": "#/definitions/entryList",
          "description": "Known problems and limitations (extended tier)"
        },
        "contributors": {
          "$ref": "#/definitions/entryList",
          "description": "Contributor acknowledgments (extended tier)"
        }
      }
    },
    "entryList": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/entry"
      }
    },
    "securityEntryList": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/securityEntry"
      }
    },
    "entry": {
      "type": "object",
      "required": ["description"],
      "properties": {
        "description": {
          "type": "string",
          "description": "Description of the change"
        },
        "issue": {
          "type": "string",
          "description": "Issue number or URL"
        },
        "pr": {
          "type": "string",
          "description": "Pull request number or URL"
        },
        "commit": {
          "type": "string",
          "description": "Commit SHA"
        },
        "author": {
          "type": "string",
          "description": "Author of the change"
        },
        "breaking": {
          "type": "boolean",
          "description": "Whether this is a breaking change",
          "default": false
        },
        "component": {
          "type": "string",
          "description": "SBOM: Component name affected"
        },
        "componentVersion": {
          "type": "string",
          "description": "SBOM: Component version"
        },
        "license": {
          "type": "string",
          "description": "SBOM: License identifier (SPDX)"
        }
      }
    },
    "securityEntry": {
      "allOf": [
        { "$ref": "#/definitions/entry" },
        {
          "type": "object",
          "properties": {
            "cve": {
              "type": "string",
              "description": "CVE identifier",
              "pattern": "^CVE-\\d{4}-\\d{4,}$"
            },
            "ghsa": {
              "type": "string",
              "description": "GitHub Security Advisory identifier",
              "pattern": "^GHSA-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}$"
            },
            "severity": {
              "type": "string",
              "description": "Severity level",
              "enum": ["critical", "high", "medium", "low", "informational"]
            },
            "cvssScore": {
              "type": "number",
              "description": "CVSS score (0.0-10.0)",
              "minimum": 0,
              "maximum": 10
            },
            "cvssVector": {
              "type": "string",
              "description": "CVSS vector string"
            },
            "cwe": {
              "type": "string",
              "description": "CWE identifier",
              "pattern": "^CWE-\\d+$"
            },
            "affectedVersions": {
              "type": "string",
              "description": "Version range affected (e.g., '<1.2.3')"
            },
            "patchedVersions": {
              "type": "string",
              "description": "Version range with fix (e.g., '>=1.2.3')"
            },
            "sarifRuleId": {
              "type": "string",
              "description": "SARIF rule ID for linking to static analysis results"
            }
          }
        }
      ]
    }
  }
}
